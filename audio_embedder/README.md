# Audio Embedder

Audio embedding service for podcast transcription and semantic search, implementing hexagonal architecture.

## Features

- Episode transcription using OpenAI or mock services
- Vector embeddings generation for semantic search
- Hexagonal architecture with pluggable transcription services
- File-based storage for transcriptions and embeddings

## Installation

```bash
pip install -e .
# Or with development dependencies
pip install -e ".[dev]"
```

## Usage

### Basic Commands

```bash
# Show all available commands
make help

# Process episodes with mock transcriptor (default)
make run

# Process episodes with OpenAI transcriptor
make run-openai

# Search episodes
make search

# Run tests
make tests
```

### Manual Commands

```bash
# Process episodes with mock transcriptor
python -m app.main --command process --transcriptor mock

# Process episodes with OpenAI transcriptor
python -m app.main --command process --transcriptor openai

# Search episodes
python -m app.main --command search --query "your search query"

# Custom file paths
python -m app.main --episodes-file /path/to/episodes.json --transcriptions-dir /path/to/transcriptions
```

## Transcription Services

### Mock Transcriptor (Default)
- No external dependencies
- Creates placeholder transcriptions for testing
- Fast execution for development

### OpenAI Transcriptor
- Uses OpenAI's `gpt-4o-mini-transcribe` model
- Requires `OPENAI_API_KEY` environment variable
- Supports streaming transcription
- Optimized for Spanish language content

## Environment Variables

```bash
# Required for OpenAI transcriptor
export OPENAI_API_KEY="your-openai-api-key"
```

## Architecture

The project follows hexagonal architecture principles:

- **Domain**: Core entities (Episode, Transcription, Embedding) and repository interfaces
- **Application**: Use cases (ProcessEpisodesUseCase, SearchEpisodesUseCase) and service interfaces
- **Infrastructure**: Concrete implementations for transcription, embedding, and storage

## Data Flow

1. Read episodes from `../data/episodes.json` (generated by podcast_crawler)
2. Check for existing transcriptions to avoid reprocessing
3. Transcribe audio files using selected transcriptor
4. Store transcriptions in `data/transcriptions/` directory
5. Generate vector embeddings from transcriptions
6. Enable semantic search across episode content

## File Structure

```
data/
├── transcriptions/       # Episode transcriptions (hash-based JSON files)
└── embeddings/          # Vector embeddings storage
```

## Development

```bash
# Install dependencies
make install

# Run tests
make tests

# Code formatting
make format

# Linting
make lint

# Clean temporary files
make clean
```

## Testing

The project includes comprehensive tests with mocking for external services:

```bash
# Run all tests
pytest tests/

# Run specific test
pytest tests/test_openai_audio_transcriptor.py -v
```